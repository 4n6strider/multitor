# shellcheck shell=bash

# ``````````````````````````````````````````````````````````````````````````````
# Function name: ProxyProcess()
#
# Description:
#   Manages proxy processes.
#
# Usage:
#   ProxyProcess port_number
#
# Examples:
#   ProxyProcess 16379
#

function ProxyProcess() {

  # shellcheck disable=SC2034
  local _FUNCTION_ID="ProxyProcess"
  local _STATE=0

  # First, we remove current processes.
  _proxy_processes=($(pidof haproxy))

  if [[ ${#_proxy_processes[@]} -ne 0 ]] ; then

    for _tpr in "${_proxy_processes[@]}" ; do

      # In this case, we can search for a specific identifier (${_tpr}).
      # shellcheck disable=SC2009,SC2034
      _hpr=$(ps -ax | grep "haproxy" | grep -v "grep" | grep "$_tpr" | grep "16379")

      if [[ -z "$_hpr" ]] ; then

        _logger "warn" \
          "${_FUNCTION_ID}()" \
          "not found or unknown proxy process"

      else

        DestroyProcess "${_hpr}"

      fi

    done

  else

    _logger "warn" \
      "${_FUNCTION_ID}()" \
      "not found proxy processes: ${_hpr}"

  fi

  CreateTorProxy

  return $_STATE

}
