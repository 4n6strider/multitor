# shellcheck shell=bash

# ``````````````````````````````````````````````````````````````````````````````
# Function name: CreateProxyProcess()
#
# Description:
#   It creates tor load balancer with haproxy.
#
# Usage:
#   CreateProxyProcess
#
# Examples:
#   CreateProxyProcess
#

function CreateProxyProcess() {

  # shellcheck disable=SC2034
  local _FUNCTION_ID="CreateProxyProcess"
  local _STATE=0

  # shellcheck disable=SC2154
  for _bk_port in "${_proxy_ports[@]}" ; do

    # shellcheck disable=SC2154
    printf "  server            tor%d 127.0.0.1:%d\n" "$_bk_port" "$_bk_port" \
    >>"${_tml_file1}"

    _logger "info" \
      "${_FUNCTION_ID}()" \
      "added backend port: '$_bk_port'"

  done

  # shellcheck disable=SC2154
  # Init proxy process.
  haproxy -f "${_tml_file1}" && \
  _logger "info" \
    "${_FUNCTION_ID}()" \
    "init proxy process with '${_tml_file1}' config file"

  return $_STATE

}
